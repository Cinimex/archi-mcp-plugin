### План внедрения: автономная инструкция для агентов + ссылка из AGENTS.md (feature-plan 8)

Цель:
- Подготовить отдельную, OS‑агностичную инструкцию для автономных агентов (CI/контейнеры, Codex и пр.) по headless‑сборке и запуску/тестированию плагина.
- Добавить явную ссылку на эту инструкцию в самом начале `AGENTS.md`.

—

Инварианты (см. текущий `AGENTS.md`):
- По умолчанию слушаем только `127.0.0.1:8765` (локально).
- Любые операции с EMF/SWT — через `Display.getDefault().syncExec(...)`.
- Источник правды по REST — `resources/openapi.json` (синхронизируем описания MCP‑инструментов при изменениях).
- Тесты располагаем под `com.archimatetool.mcp/test` внутри плагина.

—

Шаг 1. Создать документ `AUTONOMOUS_AGENTS.md`
- Размещение: `archi-mcp-plugin/AUTONOMOUS_AGENTS.md`.
- Цель документа: пошагово описать, как агенту (в контейнере/CI) собрать и прогнать плагин без UI Archi.
- Структура разделов (скелет):
  1) Обзор и целевая аудитория (автономные агенты, CI, контейнеры)
  2) Требования окружения (JDK 17; без требований к WSL/GUI)
  3) Headless‑сборка (Maven Tycho + target platform Archi 5.x; офлайн‑режим — рекомендации по локальному p2‑репозиторию)
  4) Headless‑приложение MCP (CLI‑запуск Archi: `-application com.archimatetool.mcp.headless -nosplash -consoleLog`)
  5) Конфигурация (переменные/свойства: `archi.mcp.port`, `ARCHI_MCP_PORT` и пр.)
  6) Тестовые данные (расположение `.archimate` под `com.archimatetool.mcp/testdata`)
  7) Интеграционные проверки (REST/MCP): примеры вызовов curl, сценарии smoke
  8) Логи и артефакты (stdout + файл лога; как сохранять в CI)
  9) Офлайн‑режим (как провизионить target platform и зависимости без интернета)
  10) Контейнер/CI (пример Dockerfile/скрипта; шаги pipeline)
  11) Troubleshooting (типовые ошибки биндинга порта, отсутствие активной модели и т.д.)

Шаг 2. Ссылка из `AGENTS.md`
- В начало `archi-mcp-plugin/AGENTS.md` вставить короткий блок «Если запускаете в автономной среде… см. `AUTONOMOUS_AGENTS.md`».
- Формулировка не должна менять существующие инварианты; лишь указывает альтернативный документ для автономных сценариев.

Шаг 3. Проверка предпосылок в коде/сборке
- Если headless‑приложение ещё не добавлено: запланировать в отдельной фиче (или кратко указать зависимость) добавление `org.eclipse.core.runtime.applications` → `com.archimatetool.mcp.headless` (класс `MCPHeadlessApplication`).
- Уточнить, что инструкция опирается на существующие/планируемые шаги: Tycho‑сборка, интеграционные скрипты, тестовая модель.

Шаг 4. Smoke‑проверки инструкции (OS‑агностично)
- В документ добавить минимальный набор команд:
  - Сборка: `mvn -B -Dtycho.localArtifacts=ignore clean verify`
  - Запуск Archi headless c нашим appId и портом (пример для Linux‑образа):
    ```bash
    /opt/archi/Archi -nosplash -consoleLog \
      -application com.archimatetool.mcp.headless \
      -Darchi.mcp.port=8765
    ```
  - REST‑smoke: `curl -sS http://127.0.0.1:8765/status | jq .`
- Описать ожидаемые результаты и коды возврата.

Шаг 5. Док‑ревью и вычитка
- Убедиться, что документ не ссылается на WSL/Windows‑специфику и подходит для «чистой» контейнерной среды.
- Согласовать терминологию и краткость с `AGENTS.md`.

Шаг 6. Критерии готовности (DoD)
- `AUTONOMOUS_AGENTS.md` добавлен, структурирован и самодостаточен.
- В `AGENTS.md` есть заметная ссылка в самом верху.
- Указанные команды воспроизводимы в контейнерной/CI‑среде без UI и без WSL.

Шаг 7. Роллбэк
- Удалить файл `AUTONOMOUS_AGENTS.md` и блок ссылки из `AGENTS.md`.
- Остальная документация остаётся без изменений.


